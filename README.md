## *定长内存池*

定长对象的内存池，每次申请或者归还一个内存对象T

固定大小的内存申请释放需求

特点

* 性能达到极致
* 不考虑内存碎片等问题

用自由链表来管理切好的小块内存，内存块头上存下一个内存块的地址，因此一个内存块至少要存4字节（32位）或8字节（64位）



若剩余的空间不够分配一块内存了该怎么办？引入 `_remainByte` 管理 





可以用这种方式来判断当前系统是32位还是64位，然后强转

```cpp
if (sizeof(int *) == 32) //32位
    *((int *)obj) = nullptr; 
else //64位
    *((long long*)obj) = nullptr; 



```



相比于malloc考虑的性能与内存碎片问题，tcmalloc还考虑了多线程环境下的锁竞争问题

<img src="doc/img/内存池结构.drawio.png" width="50%">



Thread cache 解决锁竞争的问题

Central cache 居中调度

Page cache 以页为单位管理大内存，用brk或mmap直接找OS的堆要内存



若要1字节，给8字节；要2自己，也给8字节；要8字节，还给8字节。存在一定的空间浪费
